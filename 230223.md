## 230223 ngrinder 튜토리얼

### nrinder controller 다운, agent 다운

https://hanseom.tistory.com/235 -> 차근차근 따라함
중간에 발생한 ngrinder 에러 해결

```
ERROR
Please set `java.io.tmpdir` property like following. tmpdir should be different from the OS default tmpdir.
`java -Djava.io.tmpdir=${NGRINDER_HOME}/lib -jar ngrinder-controller.war`
```

```
java -Djava.io.tmpdir=../Downloads -jar ngrinder-controller-3.5.8.war -p 7070
```

### script

-> home에서 script 들어가면 gui로 설정 가능, 통합 테스트 위해서는 아래 템플릿에 직접 작성

```groovy
package org.ngrinder;

import static net.grinder.script.Grinder.grinder
import static org.junit.Assert.*
import static org.hamcrest.Matchers.*
import net.grinder.plugin.http.HTTPRequest
import net.grinder.plugin.http.HTTPPluginControl;
import net.grinder.script.GTest
import net.grinder.script.Grinder
import net.grinder.scriptengine.groovy.junit.GrinderRunner
import net.grinder.scriptengine.groovy.junit.annotation.BeforeProcess
import net.grinder.scriptengine.groovy.junit.annotation.BeforeThread
import static net.grinder.util.GrinderUtils.*
import org.junit.Before
import org.junit.BeforeClass
import org.junit.Test
import org.junit.runner.RunWith

import HTTPClient.HTTPResponse
import HTTPClient.NVPair

/**
 * A simple example using the HTTP plugin that shows the retrieval of a
 * single page via HTTP.
 *
 * This script is automatically generated by ngrinder.
 *
 * @author admin
 */
@RunWith(GrinderRunner)
class TestRunner {
	public static GTest test
	public static HTTPRequest request

	// Provide a method to convert map to NVPair array
	def nvs(def map) {
		def nvs = []
		map.each {
			key, value ->  nvs.add(new NVPair(key, value))
		}
		return nvs as NVPair[]
	}

	@BeforeProcess
	public static void beforeProcess() {
		HTTPPluginControl.getConnectionDefaults().timeout = 6000
		test = new GTest(1, "49.50.164.160")
		request = new HTTPRequest()
		test.record(request);
		grinder.logger.info("before process.");
	}

	@BeforeThread
	public void beforeThread() {
		HTTPResponse result = request.POST("http://localhost:8080/members/login", nvs(["email":"yyy9942", "password":"password"]))
		grinder.statistics.delayReports=true;
		grinder.logger.info("before thread.");
	}

	@Test
	public void myInfotest() {
		request.GET("http://49.50.164.160/members/myInfo")
	}

	@Test
	public void idDuplicated() {
		request.GET("http://49.50.164.160/members/duplicated/yyy9942")
	}

	@Test
	public void categorySearch() {
		request.GET("http://49.50.164.160/categories/");
	}

	@Test
	public void searchShopByCategory() {
		request.GET("http://49.50.164.160/categories/available/shops", nvs(["categoryId":"1"]));
	}
}
```

#### References

https://hanseom.tistory.com/235
