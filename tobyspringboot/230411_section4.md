# Section 4) 독립 실행형 스프링 애플리케이션

## 스프링 컨테이너 사용

![image](https://user-images.githubusercontent.com/61377122/231067113-b5462db2-854e-4838-b8aa-8dbf3081813c.png)

```java
public class HellobootApplication {

	public static void main(String[] args) {
		GenericApplicationContext applicationContext = new GenericApplicationContext();
		applicationContext.registerBean(HelloController.class);//bean 등록
		applicationContext.refresh(); //bean object 초기화 해서 다 만들어줌

		ServletWebServerFactory serverFactory = new TomcatServletWebServerFactory(); //도우미 클래스
		WebServer webServer = serverFactory.getWebServer(servletContext -> {
 			servletContext.addServlet("frontcontroller", new HttpServlet() {
				@Override
				protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { //front controller가 Mapping
					// 인증, 보안, 다국어, 공통 기능
					if(req.getRequestURI().equals("/hello") && req.getMethod().equals(HttpMethod.GET.name())){
						String name = req.getParameter("name");
						HelloController helloController = applicationContext.getBean(HelloController.class);
						// 바인딩: 핸들러에게 웹 요청 정보를 추출하고 의미있는 오브젝트에 담아서 전달하는 작업
						String ret = helloController.hello(name);

						resp.setContentType(MediaType.TEXT_PLAIN_VALUE);//header
						resp.getWriter().println(ret);//body
					}
					else {
						resp.setStatus(HttpStatus.NOT_FOUND.value());
					}
				}
			}).addMapping("/*");//mapping
		});
		webServer.start(); //TomcatServlet Container run
	}
}
```

## 의존 오브젝트 추가

- 어떤 type의 object를 만들어두고 이것을 계속 재사용 할 수 있도록 해 줌 => singleton registry

- HelloController

```java
@RestController
public class HelloController {
    @GetMapping("/hello")
    public String hello(String name){
        SimpleHelloService simpleHelloService = new SimpleHelloService();
        return simpleHelloService.sayHello(Objects.requireNonNull(name));
    }
}
```

- SimpleHelloService

```java
public class SimpleHelloService {
    String sayHello(String name) {
        return "Hello " + name;
    }
}
```

## Dependency Injection

![image](https://user-images.githubusercontent.com/61377122/231069993-1599aafb-ffb8-4c39-8362-6f9abdc72654.png)
Spring Container(Assembler)

## 의존 오브젝트 DI 적용

````java
public interface HelloService {
    String sayHello(String name);
}
```java
public class SimpleHelloService implements HelloService {
    @Override
    public String sayHello(String name) {
        return "Hello " + name;
    }
}
````

```java
public class HelloController {
    private final HelloService helloService; //final은 재할당이 불가능하기 때문에 처음 정의했을 때 초기화를 해주거나 적어도 생성자에서 초기화 해줘야 한다

    public HelloController(HelloService helloService) {
        this.helloService = helloService;
    }

    public String hello(String name){
        return helloService.sayHello(Objects.requireNonNull(name));
    }
}
```

```java
public class HellobootApplication {

	public static void main(String[] args) {
		GenericApplicationContext applicationContext = new GenericApplicationContext();
		applicationContext.registerBean(HelloController.class);//bean 등록
		applicationContext.registerBean(SimpleHelloService.class);

		applicationContext.refresh();
		...
	}
}
```

## DispatcherServlet으로 전환

```java
public class HellobootApplication {

	public static void main(String[] args) {
		GenericWebApplicationContext applicationContext = new GenericWebApplicationContext(); //dispatcherServlet은 GenericWebApplicationContext 사용해야함
		applicationContext.registerBean(HelloController.class);//bean 등록
		applicationContext.registerBean(SimpleHelloService.class);

		applicationContext.refresh(); //bean object 초기화 해서 다 만들어줌

		ServletWebServerFactory serverFactory = new TomcatServletWebServerFactory(); //도우미 클래스
		WebServer webServer = serverFactory.getWebServer(servletContext -> {
 			servletContext.addServlet("dispatcherServlet",
					new DispatcherServlet(applicationContext)
					).addMapping("/*");//mapping
		});
		webServer.start(); //TomcatServlet Container run
	}
}
```

## Annotation mapping 정보 사용

```java
@RequestMapping//dispatcherServlet이 매핑할 때 우선 class 단의 어노테이션 체크, method 레벨에 있는 annotation을 추가함(routing은 두 개 다 포함함)
public class HelloController {
    private final HelloService helloService; //final은 재할당이 불가능하기 때문에 처음 정의했을 때 초기화를 해주거나 적어도 생성자에서 초기화 해줘야 한다

    public HelloController(HelloService helloService) {
        this.helloService = helloService;
    }

    @GetMapping("/hello")
    //@RequestMapping(value="/hello", method = RequestMethod.GET)
    @ResponseBody //리턴하는게 view이름이 아니고 response body에 넣는 text plain이라는 것을 알려줌
    // class에 @RestController 붙어있으면 안에 있는 모든 메소드에는 @ResponseBody가 붙어있다고 가정함
    public String hello(String name){
        return helloService.sayHello(Objects.requireNonNull(name));
    }
}
```
